<script lang="ts">
	import { run } from 'svelte/legacy';

	import Dropdown from '$lib/components/Dropdown.svelte';
	import Label from '$lib/components/Label.svelte';
	import {
		defaultColors,
		getColor,
		setColor,
		type DefaultColor,
		type ColorCategory
	} from '$lib/theme';
	import { capitalize } from '$lib/util';

	type Props = {
		category: ColorCategory;
	};

	let { category }: Props = $props();

	let value = $state(getColor(category));
	let customColor = $state(value.type === 'custom' ? value.hex : '#6b7280');

	let options = ['custom', ...Object.keys(defaultColors)];
	let selected = value.type === 'custom' ? 'custom' : value.name;

	function onDropdownChange(newValue: string) {
		if (newValue === 'custom') {
			value = { type: 'custom', hex: customColor };
		} else {
			value = { type: 'default', name: newValue as DefaultColor };
			setColor(category, value);
		}
	}

	function changeCustomColor(hex: string) {
		setColor(category, { type: 'custom', hex });
	}
	run(() => {
		if (value.type === 'custom') {
			changeCustomColor(customColor);
		}
	});
</script>

<div class="flex items-center">
	<Label>{capitalize(category)} color</Label>

	<Dropdown
		class="grow"
		{selected}
		items={options}
		getLabel={capitalize}
		onSelectedChange={onDropdownChange}
		multiple={false}
	/>

	{#if value.type === 'custom'}
		<input type="color" bind:value={customColor} class="ml-1 h-full grow" />
	{/if}
</div>
